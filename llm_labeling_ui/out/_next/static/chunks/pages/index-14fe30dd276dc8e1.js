(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(39973)}])},39973:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return tw}});var a,l,s,n,o=r(85893),i=r(67294),d=r(86501),c=r(88767),u=r(61162),m=r(9008),x=r.n(m);let p=e=>{let{initialState:t}=e,r=(e,r)=>{if(!r.type)return{...e,[r.field]:r.value};if("reset"===r.type)return t;throw Error()},[a,l]=(0,i.useReducer)(r,t);return(0,i.useMemo)(()=>({state:a,dispatch:l}),[a,l])},g=()=>{let e=async(e,t,r)=>{let a=(null==t?void 0:t.params)?"".concat("").concat(e).concat(t.params):""+e,l=(null==t?void 0:t.body)?t.body instanceof FormData?{...t,body:t.body}:{...t,body:JSON.stringify(t.body)}:t,s={...(null==t?void 0:t.headers)?t.headers:(null==t?void 0:t.body)&&t.body instanceof FormData?{}:{"Content-type":"application/json"}};return fetch(a,{...l,headers:s,signal:r}).then(e=>{if(!e.ok)throw e;let t=e.headers.get("content-type"),r=e.headers.get("content-disposition");e.headers;let a=t&&((null==t?void 0:t.indexOf("application/json"))!==-1||(null==t?void 0:t.indexOf("text/plain"))!==-1)?e.json():(null==r?void 0:r.indexOf("attachment"))!==-1?e.blob():e;return a}).catch(async e=>{let t=e.headers.get("content-type"),r=t&&(null==t?void 0:t.indexOf("application/problem+json"))!==-1?await e.json():e;throw r})};return{get:async(t,r)=>e(t,{...r,method:"get"}),post:async(t,r)=>e(t,{...r,method:"post"}),put:async(t,r)=>e(t,{...r,method:"put"}),patch:async(t,r)=>e(t,{...r,method:"patch"}),delete:async(t,r)=>e(t,{...r,method:"delete"})}},h=()=>{let{t:e}=(0,u.$G)("chat");return{getModelsError:(0,i.useMemo)(()=>t=>t?{title:e("Error fetching models."),code:t.status||"unknown",messageLines:t.statusText?[t.statusText]:[e("Make sure your OpenAI API key is set in the bottom left of the sidebar."),e("If you completed this step, OpenAI may be experiencing issues.")]}:null,[e])}},f=()=>{let e=g(),t=(0,i.useCallback)((t,r)=>e.post("/api/models",{body:{key:t.key,org:t.org},headers:{"Content-Type":"application/json"},signal:r}),[e]),r=(0,i.useCallback)((t,r)=>e.post("/api/conversations",{body:t,headers:{"Content-Type":"application/json"},signal:r}),[e]),a=(0,i.useCallback)((t,r)=>e.post("/api/count_tokens",{body:t,headers:{"Content-Type":"application/json"},signal:r}),[e]);return{getModels:t,getConversations:r,getTokenCount:a}},v=(0,i.createContext)(void 0);(a=l||(l={})).GPT_3_5="gpt-3.5-turbo",a.GPT_3_5_AZ="gpt-35-turbo",a.GPT_4="gpt-4",a.GPT_4_32K="gpt-4-32k",l.GPT_3_5;let b={[l.GPT_3_5]:{id:l.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[l.GPT_3_5_AZ]:{id:l.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[l.GPT_4]:{id:l.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3},[l.GPT_4_32K]:{id:l.GPT_4_32K,name:"GPT-4-32K",maxLength:96e3,tokenLimit:32e3}};var y=r(83454);y.env.OPENAI_API_HOST;let j=parseFloat(y.env.NEXT_PUBLIC_DEFAULT_TEMPERATURE||"1");y.env.OPENAI_API_TYPE,y.env.OPENAI_API_VERSION,y.env.OPENAI_ORGANIZATION,y.env.AZURE_DEPLOYMENT_ID;let w=e=>{let t=e;return t.model||(t={...t,model:t.model||b[l.GPT_3_5]}),t.prompt||(t={...t,prompt:t.prompt||""}),t.temperature||(t={...t,temperature:t.temperature||j}),t.folderId||(t={...t,folderId:t.folderId||null}),t.messages||(t={...t,messages:t.messages||[]}),t},k=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=b[l.GPT_3_5]),t.prompt||(t.prompt=""),t.temperature||(t.temperature=j),t.folderId||(t.folderId=null),t.messages||(t.messages=[]),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),N=(e,t)=>{let r=t.map(t=>t.id===e.id?e:t);return C(e),S(r),{single:e,all:r}},C=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},S=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},I=e=>{localStorage.setItem("folders",JSON.stringify(e))},P=e=>{localStorage.setItem("prompts",JSON.stringify(e))},E="settings",O=()=>{let e={theme:"dark"},t=localStorage.getItem(E);if(t)try{let r=JSON.parse(t);e=Object.assign(e,r)}catch(e){console.error(e)}return e},_=e=>{localStorage.setItem(E,JSON.stringify(e))},T="message-count-none",z="message-count-equal",Z="message-count-greater",L="message-count-less",G={apiKey:"",apiOrg:"",loading:!1,pluginKeys:[],lightMode:"dark",messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,selectedConversationPageIndex:void 0,currentMessage:void 0,prompts:[],temperature:1,showPromptbar:!0,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",messageCountFilterCount:0,messageCountFilterMode:T,defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1,page:0,pageBeforeSearch:null,selectedConversationPageIndexBeforeSearch:null,totalPages:1,totalConversations:0};var D=r(90512),R=r(57851);function A(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,R.m)((0,D.W)(t))}function K(e,t,r){let a=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(a)return e.replaceAll(t,r);{let a=RegExp(t,"gi");return e.replace(a,r)}}var M=r(47398),F=r(8971);let J=M.fC,H=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(M.ck,{ref:t,className:A("border-b",r),...a})});H.displayName="AccordionItem";let $=i.forwardRef((e,t)=>{let{className:r,children:a,...l}=e;return(0,o.jsx)(M.h4,{className:"flex",children:(0,o.jsxs)(M.xz,{ref:t,className:A("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",r),...l,children:[a,(0,o.jsx)(F.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});$.displayName=M.xz.displayName;let U=i.forwardRef((e,t)=>{let{className:r,children:a,...l}=e;return(0,o.jsx)(M.VY,{ref:t,className:A("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",r),...l,children:(0,o.jsx)("div",{className:"pb-4 pt-0",children:a})})});U.displayName=M.VY.displayName;var B=r(88426),V=r(12003);let W=(0,V.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"text-primary border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Y=i.forwardRef((e,t)=>{let{className:r,variant:a,size:l,asChild:s=!1,...n}=e,i=s?B.g7:"button";return(0,o.jsx)(i,{className:A(W({variant:a,size:l,className:r})),ref:t,...n})});Y.displayName="Button";var q=r(46069),Q=r(13742);let X=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(q.fC,{ref:t,className:A("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...a,children:(0,o.jsx)(q.z$,{className:A("flex items-center justify-center text-current"),children:(0,o.jsx)(Q.Z,{className:"h-4 w-4"})})})});X.displayName=q.fC.displayName;let ee=i.forwardRef((e,t)=>{let{className:r,type:a,...l}=e;return(0,o.jsx)("input",{type:a,className:A("text-primary flex h-10 w-full rounded-md border ring-1 ring-inset focus:ring-2 focus:ring-inset border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});ee.displayName="Input";var et=r(49102);let er=(0,V.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ea=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(et.f,{ref:t,className:A(er(),r),...a})});ea.displayName=et.f.displayName;var el=r(69819),es=r(50316);let en=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(el.fC,{className:A("grid gap-2",r),...a,ref:t})});en.displayName=el.fC.displayName;let eo=i.forwardRef((e,t)=>{let{className:r,children:a,...l}=e;return(0,o.jsx)(el.ck,{ref:t,className:A("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...l,children:(0,o.jsx)(el.z$,{className:"flex items-center justify-center",children:(0,o.jsx)(es.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});eo.displayName=el.ck.displayName;var ei=r(98963),ed=r(89014);let ec=e=>{let{onClick:t,side:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"fixed top-5 ".concat("right"===r?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===r?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,o.jsx)(ei.Z,{}):(0,o.jsx)(ed.Z,{})}),(0,o.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},eu=e=>{let{onClick:t,side:r}=e;return(0,o.jsx)("button",{className:"fixed top-2.5 ".concat("right"===r?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===r?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,o.jsx)(ed.Z,{}):(0,o.jsx)(ei.Z,{})})},em=e=>{let{isOpen:t,toggleOpen:r,side:a,component:l}=e;return t?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"fixed top-0 ".concat(a,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,o.jsx)("div",{className:"flex items-center"}),l]}),(0,o.jsx)(ec,{onClick:r,side:a})]}):(0,o.jsx)(eu,{onClick:r,side:a})};var ex=r(88238);let ep=()=>{let{state:{showPromptbar:e,selectedConversation:t,conversations:r},dispatch:a}=(0,i.useContext)(v),l=g(),[s,n]=(0,i.useState)(0),c=(0,ex.Nr)(s,300),[u,m]=(0,i.useState)(T);(0,i.useEffect)(()=>{a({field:"messageCountFilterCount",value:c})},[c]);let[x,p]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),[b,y]=(0,i.useState)(!0),j=()=>{a({field:"showPromptbar",value:!e}),localStorage.setItem("showPromptbar",JSON.stringify(!e))},w=e=>{p(e.target.value)},k=e=>{f(e.target.value)},C=e=>{n(parseInt(e.target.value,10))},S=e=>{a({field:"messageCountFilterMode",value:e}),m(e)},I=async()=>{if(t&&x&&h){let e=t.messages.map((e,t)=>(e.content=K(e.content,x,h,b),e)),s={...t,name:K(t.name,x,h,b),prompt:K(t.prompt,x,h,b),messages:[...e]};try{await l.post("/api/update_conversation",{body:s,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}let{single:n,all:o}=N(s,r);a({field:"selectedConversation",value:n}),a({field:"conversations",value:o})}};return(0,o.jsx)(em,{side:"right",isOpen:e,component:(0,o.jsxs)(J,{type:"multiple",defaultValue:["replace-item","message-count-filter"],children:[(0,o.jsxs)(H,{value:"message-count-filter",children:[(0,o.jsx)($,{children:"Message Count Filter"}),(0,o.jsx)(U,{children:(0,o.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,o.jsxs)(en,{defaultValue:T,value:u,onValueChange:S,children:[(0,o.jsxs)("div",{className:"flex items-center space-x-2 dark",children:[(0,o.jsx)(eo,{value:T,id:T}),(0,o.jsx)(ea,{htmlFor:T,children:"No filter"})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-2 dark",children:[(0,o.jsx)(eo,{value:z,id:z}),(0,o.jsx)(ea,{htmlFor:z,children:"Equal"})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-2 dark",children:[(0,o.jsx)(eo,{value:Z,id:Z}),(0,o.jsx)(ea,{htmlFor:Z,children:"Greater"})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-2 dark",children:[(0,o.jsx)(eo,{value:L,id:L}),(0,o.jsx)(ea,{htmlFor:L,children:"Less"})]})]}),(0,o.jsx)(ee,{type:"number",placeholder:"Message Count",value:s,onChange:C})]})})]}),(0,o.jsxs)(H,{value:"replace-item",children:[(0,o.jsx)($,{children:"Replace String"}),(0,o.jsx)(U,{children:(0,o.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,o.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[(0,o.jsx)(ea,{htmlFor:"original",children:"Search"}),(0,o.jsx)(ee,{type:"text",id:"original",placeholder:"Search",value:x,onChange:w})]}),(0,o.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[(0,o.jsx)(ea,{htmlFor:"replacewith",children:"Replace"}),(0,o.jsx)(ee,{type:"text",id:"replacewith",placeholder:"Replace",value:h,onChange:k})]}),(0,o.jsx)("div",{className:"flex items-center w-full gap-8",children:(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)(X,{id:"match-case",className:"dark",checked:b,onCheckedChange:e=>y(e)}),(0,o.jsx)(ea,{htmlFor:"match-case",children:"Match Case"})]})}),(0,o.jsx)(Y,{variant:"outline",onClick:I,children:"Run"})]})})]})]}),toggleOpen:j})};var eg=r(33111),eh=r(51668);(s||(s={})).GOOGLE_SEARCH="google-search",(n||(n={})).GOOGLE_SEARCH="Google Search";let ef={[s.GOOGLE_SEARCH]:{id:s.GOOGLE_SEARCH,name:n.GOOGLE_SEARCH,requiredKeys:[{key:"GOOGLE_API_KEY",value:""},{key:"GOOGLE_CSE_ID",value:""}]}};Object.values(ef);let ev=e=>e&&e.id===s.GOOGLE_SEARCH?"api/google":"api/chat",eb=e=>{let{size:t="1em",className:r=""}=e;return(0,o.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(r),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,o.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,o.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,o.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,o.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,o.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,o.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,o.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var ey=r(94568),ej=r(21223),ew=r(23461),ek=r(63072);let eN=e=>{let{prompts:t,activePromptIndex:r,onSelect:a,onMouseOver:l,promptListRef:s}=e;return(0,o.jsx)("ul",{ref:s,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,o.jsx)("li",{className:"".concat(t===r?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),a()},onMouseEnter:()=>l(t),children:e.name},e.id))})},eC=e=>{let{prompt:t,variables:r,onSubmit:a,onClose:l}=e,[s,n]=(0,i.useState)(r.map(e=>({key:e,value:""})).filter((e,t,r)=>r.findIndex(t=>t.key===e.key)===t)),d=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(e,t)=>{n(r=>{let a=[...r];return a[e].value=t,a})},m=()=>{if(s.some(e=>""===e.value)){alert("Please fill out all variables");return}a(s.map(e=>e.value)),l()},x=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&l():(e.preventDefault(),m())};return(0,i.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&l()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[l]),(0,i.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:x,children:(0,o.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,o.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),s.map((e,t)=>(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,o.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,o.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:m,children:"Submit"})]})})},eS=e=>{var t;let{onSend:r,onRegenerate:a,onScrollDownClick:l,stopConversationRef:s,textareaRef:n,showScrollDownButton:d}=e,{t:c}=(0,u.$G)("chat"),{state:{selectedConversation:m,messageIsStreaming:x,prompts:p},dispatch:g}=(0,i.useContext)(v),[h,f]=(0,i.useState)(),[b,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[k,N]=(0,i.useState)(0),[C,S]=(0,i.useState)(""),[I,P]=(0,i.useState)([]),[E,O]=(0,i.useState)(!1),[_,T]=(0,i.useState)(!1),[z,Z]=(0,i.useState)(null),L=(0,i.useRef)(null),G=p.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())),D=e=>{let t=e.target.value,r=null==m?void 0:m.model.maxLength;if(r&&t.length>r){alert(c("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}f(t),H(t)},R=()=>{if(!x){if(!h){alert(c("Please enter a message"));return}r({role:"user",content:h},z),f(""),Z(null),window.innerWidth<640&&n&&n.current&&n.current.blur()}},A=()=>{s.current=!0,setTimeout(()=>{s.current=!1},1e3)},K=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},M=()=>{let e=G[k];e&&(f(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),$(e)),w(!1)},F=e=>{j?"ArrowDown"===e.key?(e.preventDefault(),N(e=>e<p.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),N(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),N(e=>e<p.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),M()):"Escape"===e.key?(e.preventDefault(),w(!1)):N(0):"Enter"!==e.key||b||K()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),T(!_)):(e.preventDefault(),R())},J=e=>{let t;let r=/{{(.*?)}}/g,a=[];for(;null!==(t=r.exec(e));)a.push(t[1]);return a},H=(0,i.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(w(!0),S(t[0].slice(1))):(w(!1),S(""))},[]),$=e=>{let t=J(e.content);P(t),t.length>0?O(!0):(f(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),H(e.content))},U=e=>{let t=null==h?void 0:h.replace(/{{(.*?)}}/g,(t,r)=>{let a=I.indexOf(r);return e[a]});f(t),n&&n.current&&n.current.focus()};return(0,i.useEffect)(()=>{L.current&&(L.current.scrollTop=30*k)},[k]),(0,i.useEffect)(()=>{if(n&&n.current){var e,t;n.current.style.height="inherit",n.current.style.height="".concat(null===(e=n.current)||void 0===e?void 0:e.scrollHeight,"px"),n.current.style.overflow="".concat((null==n?void 0:null===(t=n.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[h]),(0,i.useEffect)(()=>{let e=e=>{L.current&&!L.current.contains(e.target)&&w(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:(0,o.jsxs)("div",{className:"stretch mx-2 mt-4 flex flex-row gap-3 last:mb-2 md:mx-4 md:mt-[52px] md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:[x&&(0,o.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:A,children:[(0,o.jsx)(ey.Z,{size:16})," ",c("Stop Generating")]}),!x&&m&&m.messages.length>0&&(0,o.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:a,children:[(0,o.jsx)(ej.Z,{size:16})," ",c("Regenerate response")]}),(0,o.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,o.jsx)("textarea",{ref:n,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==n?void 0:null===(t=n.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(n.current&&n.current.scrollHeight>400?"auto":"hidden")},placeholder:c("Type a message")||"",value:h,rows:1,onCompositionStart:()=>y(!0),onCompositionEnd:()=>y(!1),onChange:D,onKeyDown:F}),(0,o.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:R,children:x?(0,o.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,o.jsx)(ew.Z,{size:18})}),d&&(0,o.jsx)("div",{className:"absolute bottom-12 right-0 lg:bottom-0 lg:-right-10",children:(0,o.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:l,children:(0,o.jsx)(ek.Z,{size:18})})}),j&&G.length>0&&(0,o.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,o.jsx)(eN,{activePromptIndex:k,prompts:G,onSelect:M,onMouseOver:N,promptListRef:L})}),E&&(0,o.jsx)(eC,{prompt:G[k],variables:I,onSubmit:U,onClose:()=>O(!1)})]})]})})};var eI=r(90553);let eP=()=>(0,o.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,o.jsx)("div",{className:"min-w-[40px] items-end",children:(0,o.jsx)(eI.Z,{size:30})}),(0,o.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"})]})});var eE=r(8861),eO=r(21942),e_=r(88198),eT=r(67828),ez=r(80335),eZ=r(93179),eL=r(84283);let eG={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},eD=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="ABCDEFGHJKLMNPQRSTUVWXY3456789",a="";for(let t=0;t<e;t++)a+=r.charAt(Math.floor(Math.random()*r.length));return t?a.toLowerCase():a},eR=(0,i.memo)(e=>{let{language:t,value:r}=e,{t:a}=(0,u.$G)("markdown"),[l,s]=(0,i.useState)(!1),n=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(r).then(()=>{s(!0),setTimeout(()=>{s(!1)},2e3)})},d=()=>{let e=eG[t]||".file",l="file-".concat(eD(3,!0)).concat(e),s=window.prompt(a("Enter file name")||"",l);if(!s)return;let n=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=s,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,o.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,o.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:n,children:[l?(0,o.jsx)(e_.Z,{size:18}):(0,o.jsx)(eT.Z,{size:18}),l?a("Copied!"):a("Copy code")]}),(0,o.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:(0,o.jsx)(ez.Z,{size:18})})]})]}),(0,o.jsx)(eZ.Z,{language:t,style:eL.vk,customStyle:{margin:0},children:r})]})});eR.displayName="CodeBlock";var eA=r(16202);let eK=(0,i.memo)(eA.D,(e,t)=>e.children===t.children);var eM=r(97283),eF=r(74075),eJ=r(67421);let eH=e=>{let{onDeleteMessage:t}=e,[r,a]=(0,i.useState)(!1),{t:l}=(0,eJ.$G)("sidebar"),s=()=>{t(),a(!1)};return r?(0,o.jsx)("div",{className:"flex w-full cursor-pointer items-center rounded-lg hover:bg-gray-100",children:(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(e_.Z,{className:"ml-auto mr-1 min-w-[20px] hover:text-green-500",size:18,onClick:e=>{e.stopPropagation(),s()}}),(0,o.jsx)(eM.Z,{className:"ml-auto min-w-[20px] hover:text-red-500",size:18,onClick:e=>{e.stopPropagation(),a(!1)}})]})}):(0,o.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:()=>a(!0),children:(0,o.jsx)(eF.Z,{size:20})})};var e$=r(51609);let eU=e=>{let{onSplitConversation:t}=e,[r,a]=(0,i.useState)(!1),{t:l}=(0,eJ.$G)("sidebar"),s=()=>{t(),a(!1)};return r?(0,o.jsx)("div",{className:"flex w-full cursor-pointer items-center rounded-lg hover:bg-gray-100",children:(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(e_.Z,{className:"ml-auto mr-1 min-w-[20px] hover:text-green-500",size:18,onClick:e=>{e.stopPropagation(),s()}}),(0,o.jsx)(eM.Z,{className:"ml-auto min-w-[20px] hover:text-red-500",size:18,onClick:e=>{e.stopPropagation(),a(!1)}})]})}):(0,o.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:()=>a(!0),children:(0,o.jsx)(e$.Z,{size:20})})};var eB=r(45884),eV=r(29758),eW=r(30399);let eY=(0,i.memo)(e=>{var t;let r,{message:a,messageIndex:l,tokenData:s,onEdit:n}=e,{t:c}=(0,u.$G)("chat"),m=g(),{state:{selectedConversation:x,conversations:p,currentMessage:h,messageIsStreaming:f},handleSplitConversation:b,dispatch:y}=(0,i.useContext)(v),[j,w]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[S,I]=(0,i.useState)(a.content),[P,E]=(0,i.useState)(!1),[O,_]=(0,i.useState)(void 0);(0,i.useEffect)(()=>{let e=null==s?void 0:s.messagesTokenCounts.reduce((e,t)=>(e.push((e.length>0?e[e.length-1]:0)+t),e),[]);_(e)},[s]);let T=(0,i.useRef)(null),z=()=>{w(!j)},Z=e=>{I(e.target.value),T.current&&(T.current.style.height="inherit",T.current.style.height="".concat(T.current.scrollHeight,"px"))},L=()=>{a.content!=S&&x&&n&&n({...a,content:S},"assistant"===a.role),w(!1)},G=()=>{a.content!=S&&x&&n&&n({...a,content:S},!0),w(!1)},D=async()=>{if(!x)return;let{messages:e}=x,t=e.findIndex(e=>e===a);if(t<0)return;t<e.length-1&&"assistant"===e[t+1].role?e.splice(t,2):e.splice(t,1);let r={...x,messages:e};try{await m.post("/api/update_conversation",{body:r,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}let{single:l,all:s}=N(r,p);y({field:"selectedConversation",value:l}),y({field:"conversations",value:s})},R=e=>{"Enter"!==e.key||k||e.shiftKey||(e.preventDefault(),L())};return(0,i.useEffect)(()=>{I(a.content)},[a.content]),(0,i.useEffect)(()=>{T.current&&(T.current.style.height="inherit",T.current.style.height="".concat(T.current.scrollHeight,"px"))},[j]),(0,o.jsx)("div",{className:"group md:px-4 ".concat("assistant"===a.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"relative m-auto flex p-4 flex-col text-base md:max-w-2xl lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:["user"===a.role&&(0,o.jsx)("div",{className:"text-gray-500 dark:text-gray-500",children:(r="Round ".concat(l/2+1),s&&O&&0!==O[O.length-1]&&(r+=", Current round token: ".concat(s.messagesTokenCounts[l]+s.messagesTokenCounts[l+1])+", Context token: ".concat(O[l]-s.messagesTokenCounts[l]+s.promptTokenCount)),r)}),(0,o.jsxs)("div",{className:"relative flex text-base md:gap-6 md:py-2",children:[(0,o.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===a.role?(0,o.jsx)(eI.Z,{size:30}):(0,o.jsx)(eE.Z,{size:30})}),(0,o.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:(0,o.jsxs)("div",{className:"flex w-full",children:[j?(0,o.jsxs)("div",{className:"flex w-full flex-col",children:[(0,o.jsx)("textarea",{ref:T,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:S,onChange:Z,onKeyDown:R,onCompositionStart:()=>C(!0),onCompositionEnd:()=>C(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,o.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:["user"===a.role?(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:G,disabled:S.trim().length<=0,children:c("Save")}),(0,o.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:L,disabled:S.trim().length<=0,children:c("Save & Submit")})]}):(0,o.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:L,disabled:S.trim().length<=0,children:c("Save")}),(0,o.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{I(a.content),w(!1)},children:c("Cancel")})]})]}):"user"===a.role?(0,o.jsx)("div",{className:"prose whitespace-pre-wrap dark:prose-invert flex-1",children:a.content}):(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsx)("div",{className:"flex flex-row",children:(0,o.jsx)(eK,{className:"prose dark:prose-invert flex-1",remarkPlugins:[eV.Z,eW.Z],rehypePlugins:[eB.Z],components:{code(e){let{node:t,inline:r,className:a,children:l,...s}=e;if(l.length){if("▍"==l[0])return(0,o.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"});l[0]=l[0].replace("`▍`","▍")}let n=/language-(\w+)/.exec(a||"");return r?(0,o.jsx)("code",{className:a,...s,children:l}):(0,o.jsx)(eR,{language:n&&n[1]||"",value:String(l).replace(/\n$/,""),...s},Math.random())},table(e){let{children:t}=e;return(0,o.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,o.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,o.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:"".concat(a.content).concat(f&&l==(null!==(t=null==x?void 0:x.messages.length)&&void 0!==t?t:0)-1?"`▍`":"")})})}),!j&&(0,o.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,o.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:z,children:(0,o.jsx)(eO.Z,{size:20})}),(0,o.jsx)(eH,{onDeleteMessage:D}),"user"===a.role&&0!==l&&(0,o.jsx)(eU,{onSplitConversation:()=>{x&&b(x,l)}})]})]})})]})]})})});eY.displayName="ChatMessage";var eq=r(93844);let eQ=e=>{var t;let{conversation:r,prompts:a,onChangePrompt:l}=e,{t:s}=(0,u.$G)("chat"),[n,d]=(0,i.useState)(""),[c,m]=(0,i.useState)(0),[x,p]=(0,i.useState)(!1),[g,h]=(0,i.useState)(""),[f,v]=(0,i.useState)([]),[b,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),k=(0,i.useRef)(null),N=(0,i.useRef)(null),C=a.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())),S=e=>{if("compositionstart"===e.type||"compositionend"===e.type)l(n);else{let t=e.target.value;console.log("handle change ".concat(t)),d(t),j||l(t)}},I=()=>{let e=C[c];d(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),O(e),p(!1)},P=e=>{let t;let r=/{{(.*?)}}/g,a=[];for(;null!==(t=r.exec(e));)a.push(t[1]);return a},E=(0,i.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(p(!0),h(t[0].slice(1))):(p(!1),h(""))},[]),O=e=>{let t=P(e.content);if(v(t),t.length>0)y(!0);else{let t=null==n?void 0:n.replace(/\/\w*$/,e.content);d(t),l(t),E(e.content)}},_=e=>{let t=null==n?void 0:n.replace(/{{(.*?)}}/g,(t,r)=>{let a=f.indexOf(r);return e[a]});d(t),l(t),k&&k.current&&k.current.focus()};return(0,i.useEffect)(()=>{if(k&&k.current){var e;k.current.style.height="inherit",k.current.style.height="".concat(null===(e=k.current)||void 0===e?void 0:e.scrollHeight,"px")}},[n]),(0,i.useEffect)(()=>{d(r.prompt)},[r]),(0,i.useEffect)(()=>{let e=e=>{N.current&&!N.current.contains(e.target)&&p(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:s("System Prompt")}),(0,o.jsx)("textarea",{ref:k,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{resize:"none",bottom:"".concat(null==k?void 0:null===(t=k.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(k.current&&k.current.scrollHeight>400?"auto":"hidden")},placeholder:s('Enter a prompt or type "/" to select a prompt...')||"",value:s(n)||"",rows:1,onChange:S,onCompositionStart:()=>w(!0),onCompositionEnd:e=>{w(!1),S(e)}}),x&&C.length>0&&(0,o.jsx)("div",{children:(0,o.jsx)(eN,{activePromptIndex:c,prompts:C,onSelect:I,onMouseOver:m,promptListRef:N})}),b&&(0,o.jsx)(eC,{prompt:a[c],variables:f,onSubmit:_,onClose:()=>y(!1)})]})},eX=()=>{var e;let{t}=(0,u.$G)("chat"),{state:{selectedConversation:r,models:a,defaultModelId:l,prompts:s},handleUpdateConversation:n,dispatch:d}=(0,i.useContext)(v),c=e=>{r&&n(r,{key:"model",value:a.find(t=>t.id===e.target.value)})};return(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Model")}),(0,o.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,o.jsx)("select",{className:"w-full bg-transparent p-2",placeholder:t("Select a model")||"",value:(null==r?void 0:null===(e=r.model)||void 0===e?void 0:e.id)||l,onChange:c,children:a.map(e=>(0,o.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.id===l?"Default (".concat(e.name,")"):e.name},e.id))})}),(0,o.jsx)("div",{className:"w-full mt-3 mb-3 text-left text-neutral-700 dark:text-neutral-400 flex items-center",children:(0,o.jsxs)("a",{href:"https://platform.openai.com/account/usage",target:"_blank",className:"flex items-center",children:[(0,o.jsx)(eq.Z,{size:18,className:"inline mr-1"}),t("View Account Usage")]})}),r?(0,o.jsx)(eQ,{conversation:r,prompts:s,onChangePrompt:e=>n(r,{key:"prompt",value:e})}):(0,o.jsx)(o.Fragment,{})]})},e0=e=>{var t;let{label:r,onChangeTemperature:a}=e,{state:{conversations:l}}=(0,i.useContext)(v),s=l[l.length-1],[n,d]=(0,i.useState)(null!==(t=null==s?void 0:s.temperature)&&void 0!==t?t:j),{t:c}=(0,u.$G)("chat"),m=e=>{let t=parseFloat(e.target.value);d(t),a(t)};return(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:r}),(0,o.jsx)("span",{className:"text-[12px] text-black/50 dark:text-white/50 text-sm",children:c("Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.")}),(0,o.jsx)("span",{className:"mt-2 mb-1 text-center text-neutral-900 dark:text-neutral-100",children:n.toFixed(1)}),(0,o.jsx)("input",{className:"cursor-pointer",type:"range",min:0,max:1,step:.1,value:n,onChange:m}),(0,o.jsxs)("ul",{className:"w mt-2 pb-8 flex justify-between px-[24px] text-neutral-900 dark:text-neutral-100",children:[(0,o.jsx)("li",{className:"flex justify-center",children:(0,o.jsx)("span",{className:"absolute",children:c("Precise")})}),(0,o.jsx)("li",{className:"flex justify-center",children:(0,o.jsx)("span",{className:"absolute",children:c("Neutral")})}),(0,o.jsx)("li",{className:"flex justify-center",children:(0,o.jsx)("span",{className:"absolute",children:c("Creative")})})]})]})},e1=(0,i.memo)(e=>{let t,r,{stopConversationRef:a}=e,{t:l}=(0,u.$G)("chat"),{state:{selectedConversation:s,conversations:n,models:m,apiKey:x,apiOrg:p,pluginKeys:h,serverSideApiKeyIsSet:y,messageIsStreaming:j,modelError:w,loading:k,prompts:I},handleUpdateConversation:P,dispatch:E}=(0,i.useContext)(v),O=g(),{getTokenCount:_}=f(),T=(0,ex.Nr)(s,500),{data:z,error:Z,refetch:L}=(0,c.useQuery)(["GetTokenCount",T],e=>{let{signal:t}=e,r=[];return null==T||T.messages.forEach(e=>{r.push(e.content)}),_({prompt:T?T.prompt:"",messages:r},t)},{enabled:!0,refetchOnMount:!1}),G=z?(null==z?void 0:z.promptTokenCount)+(null==z?void 0:z.messagesTokenCounts.reduce((e,t)=>e+t,0)):0,[D,R]=(0,i.useState)(),[A,K]=(0,i.useState)(!0),[M,F]=(0,i.useState)(!1),[J,H]=(0,i.useState)(!1),$=(0,i.useRef)(null),U=(0,i.useRef)(null),B=(0,i.useRef)(null),V=(0,i.useCallback)(async function(e){let t,r,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!s)return;if(null===i){if(l){let r=[...s.messages];for(let e=0;e<l;e++)r.pop();t={...s,messages:[...r,e]}}else t={...s,messages:[...s.messages,e]};E({field:"selectedConversation",value:t})}else{let r=s.messages.map((t,r)=>r===i?e:t);t={...s,messages:[...r]};try{await O.post("/api/update_conversation",{body:t,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}let{single:a,all:l}=N(t,n);E({field:"selectedConversation",value:a}),E({field:"conversations",value:l});return}E({field:"loading",value:!0}),E({field:"messageIsStreaming",value:!0});let c={model:b[t.model.id],messages:t.messages,key:x,org:p,prompt:t.prompt,temperature:t.temperature},u=ev(o);if(o){var m,g,f,v;r=JSON.stringify({...c,googleAPIKey:null===(m=null===(g=h.find(e=>"google-search"===e.pluginId))||void 0===g?void 0:g.requiredKeys.find(e=>"GOOGLE_API_KEY"===e.key))||void 0===m?void 0:m.value,googleCSEId:null===(f=null===(v=h.find(e=>"google-search"===e.pluginId))||void 0===v?void 0:v.requiredKeys.find(e=>"GOOGLE_CSE_ID"===e.key))||void 0===f?void 0:f.value})}else r=JSON.stringify(c);let y=new AbortController,j=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},signal:y.signal,body:r});if(!j.ok){E({field:"loading",value:!1}),E({field:"messageIsStreaming",value:!1}),d.ZP.error(j.statusText);return}let w=j.body;if(!w){E({field:"loading",value:!1}),E({field:"messageIsStreaming",value:!1});return}if(o){let{answer:e}=await j.json(),r=[...t.messages,{role:"assistant",content:e}];t={...t,messages:r},E({field:"selectedConversation",value:N}),C(t);let a=n.map(e=>e.id===s.id?t:e);0===a.length&&a.push(t),E({field:"conversations",value:a}),S(a),E({field:"loading",value:!1}),E({field:"messageIsStreaming",value:!1})}else{if(1===t.messages.length){let{content:r}=e,a=r.length>30?r.substring(0,30)+"...":r;t={...t,name:a}}E({field:"loading",value:!1});let r=w.getReader(),l=new TextDecoder,o=!1,i=!0,c="";for(;!o;){if(!0===a.current){y.abort(),o=!0;break}let{value:e,done:s}=await r.read();o=s;let n=l.decode(e);if(c+=n,i){i=!1;let e=[...t.messages,{role:"assistant",content:n}];E({field:"selectedConversation",value:t={...t,messages:e}})}else{let e=t.messages.map((e,r)=>r===t.messages.length-1?{...e,content:c}:e);E({field:"selectedConversation",value:t={...t,messages:e}})}}C(t);let u=n.map(e=>e.id===s.id?t:e);0===u.length&&u.push(t);try{await O.post("/api/update_conversation",{body:t,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}E({field:"conversations",value:u}),S(u),E({field:"messageIsStreaming",value:!1})}},[x,n,h,s,a]);(0,i.useCallback)(()=>{if(A){var e,t;null===(e=$.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=B.current)||void 0===t||t.focus()}},[A]);let W=()=>{if(U.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=U.current;e+r<t-30?(K(!1),H(!0)):(K(!0),H(!1))}},Y=()=>{var e;null===(e=U.current)||void 0===e||e.scrollTo({top:U.current.scrollHeight,behavior:"smooth"})},q=()=>{F(!M)},Q=()=>{confirm(l("Are you sure you want to clear all messages?"))&&s&&P(s,{key:"messages",value:[]})},X=()=>{if(A){var e;null===(e=$.current)||void 0===e||e.scrollIntoView(!0)}},ee=function(){for(var e=arguments.length,a=Array(e),l=0;l<e;l++)a[l]=arguments[l];r?(clearTimeout(t),t=setTimeout(()=>{Date.now()-r>=250&&(X(...a),r=Date.now())},250-(Date.now()-r))):(X(...a),r=Date.now())};return(0,i.useEffect)(()=>{ee(),s&&R(s.messages[s.messages.length-2])},[s,ee]),(0,i.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(K(t.isIntersecting),t.isIntersecting){var r;null===(r=B.current)||void 0===r||r.focus()}},{root:null,threshold:.5}),t=$.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[$]),(0,o.jsxs)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:[(0,o.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:U,onScroll:W,children:(null==s?void 0:s.messages.length)===0?(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"mx-auto flex flex-col space-y-5 md:space-y-10 px-3 pt-5 md:pt-12 sm:max-w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:0===m.length?(0,o.jsx)("div",{children:(0,o.jsx)(eb,{size:"16px",className:"mx-auto"})}):"LLM Labeling UI"}),m.length>0&&(0,o.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,o.jsx)(eX,{}),(0,o.jsx)(e0,{label:l("Temperature"),onChangeTemperature:e=>P(s,{key:"temperature",value:e})})]})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"sticky top-0 z-10 flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[l("Model"),": ",null==s?void 0:s.model.name," | ",l("Temp"),":"," ",null==s?void 0:s.temperature," | Message:"," ",null==s?void 0:s.messages.length," ",0===G?"":"| ".concat(l("Tokens"),": ").concat(G),(0,o.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:q,children:(0,o.jsx)(eg.Z,{size:18})}),(0,o.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:Q,children:(0,o.jsx)(eh.Z,{size:18})})]}),M&&(0,o.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,o.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,o.jsx)(eX,{})})}),null==s?void 0:s.messages.map((e,t)=>(0,o.jsx)(eY,{message:e,messageIndex:t,tokenData:z,onEdit:(e,r)=>{R(e),r?V(e,0,null,t):V(e,(null==s?void 0:s.messages.length)-t,null)}},t)),k&&(0,o.jsx)(eP,{}),(0,o.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:$})]})}),(0,o.jsx)(eS,{stopConversationRef:a,textareaRef:B,onSend:(e,t)=>{R(e),V(e,0,t)},onScrollDownClick:Y,onRegenerate:()=>{D&&V(D,2,null)},showScrollDownButton:J})]})});e1.displayName="Chat";let e2=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),r=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),r&&(r=JSON.parse(r));let a={version:4,history:e||[],folders:t||[],prompts:r||[]},l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),s=URL.createObjectURL(l),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,r=e.getDate(),a=e.getFullYear();return"".concat(a,"-").concat(t,"-").concat(r,"-").concat(e.getTime())}(),".json"),n.href=s,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},e4=e=>{let{history:t,folders:r,prompts:a}=function(e){if(Array.isArray(e))return{version:4,history:k(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:k(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),l=localStorage.getItem("conversationHistory"),s=l?JSON.parse(l):[],n=[...s,...t].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));localStorage.setItem("conversationHistory",JSON.stringify(n)),n.length>0?localStorage.setItem("selectedConversation",JSON.stringify(n[n.length-1])):localStorage.removeItem("selectedConversation");let o=localStorage.getItem("folders"),i=o?JSON.parse(o):[],d=[...i,...r].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));localStorage.setItem("folders",JSON.stringify(d));let c=localStorage.getItem("prompts"),u=c?JSON.parse(c):[],m=[...u,...a].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));return localStorage.setItem("prompts",JSON.stringify(m)),{version:4,history:n,folders:d,prompts:m}};var e3=r(87664),e5=r(62577),e8=r(30471);let e6=e=>{let{handleClick:t,children:r}=e;return(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:r})},e7=e=>{let{currentFolder:t,searchTerm:r,handleDrop:a,folderComponent:l}=e,{handleDeleteFolder:s,handleUpdateFolder:n}=(0,i.useContext)(v),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),[x,p]=(0,i.useState)(""),[g,h]=(0,i.useState)(!1),f=e=>{"Enter"===e.key&&(e.preventDefault(),b())},b=()=>{n(t.id,x),p(""),m(!1)},y=e=>{e.dataTransfer&&(h(!0),a(e,t),e.target.style.background="none")},j=e=>{e.preventDefault()},w=e=>{e.target.style.background="#343541"},k=e=>{e.target.style.background="none"};return(0,i.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,i.useEffect)(()=>{r?h(!0):h(!1)},[r]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"relative flex items-center",children:[u?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[g?(0,o.jsx)(e3.Z,{size:18}):(0,o.jsx)(e5.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:f,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>h(!g),onDrop:e=>y(e),onDragOver:j,onDragEnter:w,onDragLeave:k,children:[g?(0,o.jsx)(e3.Z,{size:18}):(0,o.jsx)(e5.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(e6,{handleClick:e=>{e.stopPropagation(),d?s(t.id):u&&b(),c(!1),m(!1)},children:(0,o.jsx)(e_.Z,{size:18})}),(0,o.jsx)(e6,{handleClick:e=>{e.stopPropagation(),c(!1),m(!1)},children:(0,o.jsx)(eM.Z,{size:18})})]}),!d&&!u&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(e6,{handleClick:e=>{e.stopPropagation(),m(!0),p(t.name)},children:(0,o.jsx)(e8.Z,{size:18})}),(0,o.jsx)(e6,{handleClick:e=>{e.stopPropagation(),c(!0)},children:(0,o.jsx)(eF.Z,{size:18})})]})]}),g?l:null]})};var e9=r(47447);let te=(0,i.createContext)(void 0),tt=e=>{let{conversation:t,conversationPageIndex:r}=e,{state:{selectedConversation:a,messageIsStreaming:l},handleSelectConversation:s,handleUpdateConversation:n}=(0,i.useContext)(v),{handleDeleteConversation:d}=(0,i.useContext)(te),[c,u]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),[p,g]=(0,i.useState)(""),h=e=>{"Enter"===e.key&&(e.preventDefault(),a&&b(a))},f=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},b=e=>{p.trim().length>0&&(n(e,{key:"name",value:p}),g(""),x(!1))},y=e=>{e.stopPropagation(),c?d(t):m&&b(t),u(!1),x(!1)},j=e=>{e.stopPropagation(),u(!1),x(!1)},w=e=>{e.stopPropagation(),x(!0),a&&g(a.name)},k=e=>{e.stopPropagation(),u(!0)};return(0,i.useEffect)(()=>{m?u(!1):c&&x(!1)},[m,c]),(0,o.jsxs)("div",{className:"relative flex items-center",children:[m&&(null==a?void 0:a.id)===t.id?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,o.jsx)(e9.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:p,onChange:e=>g(e.target.value),onKeyDown:h,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(l?"disabled:cursor-not-allowed":""," ").concat((null==a?void 0:a.id)===t.id?"bg-[#343541]/90":""),onClick:()=>s(t,r),disabled:l,draggable:"true",onDragStart:e=>f(e,t),children:[(0,o.jsx)(e9.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==a?void 0:a.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(c||m)&&(null==a?void 0:a.id)===t.id&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(e6,{handleClick:y,children:(0,o.jsx)(e_.Z,{size:18})}),(0,o.jsx)(e6,{handleClick:j,children:(0,o.jsx)(eM.Z,{size:18})})]}),(null==a?void 0:a.id)===t.id&&!c&&!m&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(e6,{handleClick:w,children:(0,o.jsx)(e8.Z,{size:18})}),(0,o.jsx)(e6,{handleClick:k,children:(0,o.jsx)(eF.Z,{size:18})})]})]})},tr=e=>{let{searchTerm:t}=e,{state:{folders:r,conversations:a},handleUpdateConversation:l}=(0,i.useContext)(v),s=(e,t)=>{if(e.dataTransfer){let r=JSON.parse(e.dataTransfer.getData("conversation"));l(r,{key:"folderId",value:t.id})}},n=e=>a&&a.filter(e=>e.folderId).map((t,r)=>{if(t.folderId===e.id)return(0,o.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,o.jsx)(tt,{conversation:t,conversationPageIndex:0})},r)});return(0,o.jsx)("div",{className:"flex w-full flex-col pt-2",children:r.filter(e=>"chat"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,r)=>(0,o.jsx)(e7,{searchTerm:t,currentFolder:e,handleDrop:s,folderComponent:n(e)},r))})};var ta=r(52475),tl=r(35336);let ts=e=>{let{apiKey:t,onApiKeyChange:r}=e,{t:a}=(0,u.$G)("sidebar"),[l,s]=(0,i.useState)(!1),[n,d]=(0,i.useState)(t),c=(0,i.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(n))},x=e=>{r(e.trim()),s(!1)};return(0,i.useEffect)(()=>{if(l){var e;null===(e=c.current)||void 0===e||e.focus()}},[l]),l?(0,o.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10 text-black dark:text-neutral-200",children:[(0,o.jsx)(tl.Z,{size:18}),(0,o.jsx)("input",{ref:c,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-black dark:text-neutral-200 outline-none focus:border-neutral-100",type:"password",value:n,onChange:e=>d(e.target.value),onKeyDown:m,placeholder:a("API Key")||"API Key"}),(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(e_.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-black",size:18,onClick:e=>{e.stopPropagation(),x(n)}}),(0,o.jsx)(eM.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-black",size:18,onClick:e=>{e.stopPropagation(),s(!1),d(t)}})]})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-black dark:text-neutral-200 transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>s(!0),children:[(0,o.jsx)("div",{children:(0,o.jsx)(tl.Z,{size:18})}),(0,o.jsx)("span",{children:a("OpenAI API Key")})]})};var tn=r(15710);let to=e=>{let{apiOrg:t,onApiOrgChange:r}=e,{t:a}=(0,u.$G)("sidebar"),[l,s]=(0,i.useState)(!1),[n,d]=(0,i.useState)(t),c=(0,i.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(n))},x=e=>{r(e.trim()),s(!1)};return(0,i.useEffect)(()=>{if(l){var e;null===(e=c.current)||void 0===e||e.focus()}},[l]),l?(0,o.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10 text-black dark:text-neutral-200",children:[(0,o.jsx)(tn.Z,{size:18}),(0,o.jsx)("input",{ref:c,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-black dark:text-neutral-200 outline-none focus:border-neutral-100",value:n,onChange:e=>d(e.target.value),onKeyDown:m,placeholder:a("API Organization")||"API Organization"}),(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(e_.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-black",size:18,onClick:e=>{e.stopPropagation(),x(n)}}),(0,o.jsx)(eM.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-black",size:18,onClick:e=>{e.stopPropagation(),s(!1),d(t)}})]})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-black dark:text-neutral-200 transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>s(!0),children:[(0,o.jsx)("div",{children:(0,o.jsx)(tn.Z,{size:18})}),(0,o.jsx)("span",{children:a("OpenAI Organization")})]})},ti=e=>{let{open:t,onClose:r}=e,{t:a}=(0,u.$G)("settings"),l=O(),{state:s,dispatch:n}=p({initialState:l}),d=(0,i.useRef)(null),{state:{apiKey:c,apiOrg:m},dispatch:x}=(0,i.useContext)(v),{handleApiKeyChange:g,handleApiOrgChange:h}=(0,i.useContext)(te);return((0,i.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),r()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[r]),t)?(0,o.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,o.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,o.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,o.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"text-lg pb-4 font-bold text-black dark:text-neutral-200",children:a("Settings")}),(0,o.jsx)(ts,{apiKey:c,onApiKeyChange:g}),(0,o.jsx)(to,{apiOrg:m,onApiOrgChange:h}),(0,o.jsxs)("div",{className:"flex cursor-pointer px-3 py-1 rounded-md hover:bg-gray-500/10 items-center justify-center",children:[(0,o.jsx)("div",{className:"text-black dark:text-neutral-200",children:(0,o.jsx)(ta.Z,{size:18})}),(0,o.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:s.theme,onChange:e=>{n({field:"theme",value:e.target.value}),x({field:"lightMode",value:s.theme}),_(s)},children:[(0,o.jsx)("option",{value:"dark",children:a("Light mode")}),(0,o.jsx)("option",{value:"light",children:a("Dark mode")})]})]}),(0,o.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{r()},children:a("Close")})]})]})})}):(0,o.jsx)(o.Fragment,{})},td=e=>{let{text:t,icon:r,onClick:a}=e;return(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:a,children:[(0,o.jsx)("div",{children:r}),(0,o.jsx)("span",{children:t})]})},tc=()=>{let{t:e}=(0,u.$G)("sidebar"),[t,r]=(0,i.useState)(!1);return(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[(0,o.jsx)(td,{text:e("Settings"),icon:(0,o.jsx)(eg.Z,{size:18}),onClick:()=>r(!0)}),(0,o.jsx)(ti,{open:t,onClose:()=>{r(!1)}})]})},tu=e=>{let{conversations:t}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,o.jsx)(tt,{conversation:e,conversationPageIndex:t},t))})},tm=e=>{let{page:t,totalConversations:r,totalPages:a,onPageChange:l}=e,[s,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(t),u=(0,i.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{l(e-1),c(e),n(!1)};return(0,i.useEffect)(()=>{if(s){var e;null===(e=u.current)||void 0===e||e.focus()}},[s]),s?(0,o.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-1 px-3 transition-colors hover:bg-gray-500/10",children:[(0,o.jsx)("input",{ref:u,className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none w-[30px] h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",type:"number",value:d,onChange:e=>c(parseInt(e.target.value,10)),onKeyDown:m}),(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(e_.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,o.jsx)(eM.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),n(!1),c(t)}})]})]}):(0,o.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:()=>n(!0),children:0===a?0:"".concat(t," / ").concat(a," (").concat(r,")")})},tx=()=>{let{state:{totalPages:e,page:t,totalConversations:r},dispatch:a}=(0,i.useContext)(v),l=()=>{t>0?a({field:"page",value:t-1}):0===t&&a({field:"page",value:e-1}),a({field:"selectedConversationPageIndex",value:0})},s=()=>{t<e-1?a({field:"page",value:t+1}):t===e-1&&a({field:"page",value:0}),a({field:"selectedConversationPageIndex",value:0})},n=t=>{t>e-1&&(t=e-1),t<0&&(t=0),a({field:"page",value:t}),a({field:"selectedConversationPageIndex",value:0})};return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:(0,o.jsxs)("div",{className:"flex flex-row w-full items-center justify-between",children:[(0,o.jsx)("button",{className:"text-sidebar py-1 w-[30px] flex-shrink-0 cursor-pointer select-none items-center rounded-md border border-white/20 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:l,children:"<"}),(0,o.jsx)(tm,{page:t+1,totalPages:e,totalConversations:r,onPageChange:n}),(0,o.jsx)("button",{className:"text-sidebar py-1 w-[30px] flex-shrink-0 cursor-pointer select-none items-center rounded-md border border-white/20 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:s,children:">"})]})})};var tp=r(1177),tg=r(92005);let th=e=>{let{placeholder:t,searchTerm:r,onSearch:a}=e,{t:l}=(0,u.$G)("sidebar"),[s,n]=(0,i.useState)(r),d=(0,ex.Nr)(s,500);(0,i.useEffect)(()=>{a(d)},[d]);let c=e=>{console.log("search change"),n(e.target.value)},m=()=>{a(""),n("")};return(0,o.jsxs)("div",{className:"relative flex items-center",children:[(0,o.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:l(t)||"",value:s,onChange:c}),s&&(0,o.jsx)(eM.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:m})]})},tf=e=>{let{isOpen:t,addItemButtonTitle:r,side:a,items:l,itemComponent:s,folderComponent:n,paginatorComponent:i,footerComponent:d,searchTerm:c,handleSearchTerm:u,toggleOpen:m,handleCreateItem:x,handleCreateFolder:p,handleDrop:g}=e,{t:h}=(0,eJ.$G)("promptbar"),f=e=>{e.preventDefault()},v=e=>{e.target.style.background="#343541"},b=e=>{e.target.style.background="none"};return t?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"fixed top-0 ".concat(a,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,o.jsx)("div",{className:"flex items-center",children:(0,o.jsxs)("button",{className:"text-sidebar flex grow cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{x(),u("")},children:[(0,o.jsx)(tp.Z,{size:16}),r]})}),(0,o.jsx)(th,{placeholder:h("Search...")||"",searchTerm:c,onSearch:u}),i,(0,o.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==l?void 0:l.length)>0&&(0,o.jsx)("div",{className:"flex border-b border-white/20",children:n}),(null==l?void 0:l.length)>0?(0,o.jsx)("div",{className:"pt-2",onDrop:g,onDragOver:f,onDragEnter:v,onDragLeave:b,children:s}):(0,o.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,o.jsx)(tg.Z,{className:"mx-auto mb-3"}),(0,o.jsx)("span",{className:"text-[14px] leading-normal",children:h("No data.")})]})]}),d]}),(0,o.jsx)(ec,{onClick:m,side:a})]}):(0,o.jsx)(eu,{onClick:m,side:a})},tv={searchTerm:"",filteredConversations:[]};var tb=r(57632);let ty=()=>{let{t:e}=(0,u.$G)("sidebar");g();let t=p({initialState:tv}),{state:{conversations:r,showChatbar:a,defaultModelId:l,folders:s,pluginKeys:n,page:d,pageBeforeSearch:c,selectedConversationPageIndex:m,selectedConversationPageIndexBeforeSearch:x},dispatch:h,handleCreateFolder:f,handleNewConversation:y,handleUpdateConversation:w,handleDeleteConversation:k}=(0,i.useContext)(v),{state:{searchTerm:N},dispatch:C}=t,S=(0,i.useCallback)(e=>{h({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[h]),P=(0,i.useCallback)(e=>{h({field:"apiOrg",value:e}),localStorage.setItem("apiOrg",e)},[h]),E=e=>{if(n.some(t=>t.pluginId===e.pluginId)){let t=n.map(t=>t.pluginId===e.pluginId?e:t);h({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else h({field:"pluginKeys",value:[...n,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...n,e]))},O=e=>{let t=n.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){h({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}h({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},_=()=>{e2()},T=e=>{let{history:t,folders:r,prompts:a}=e4(e);h({field:"conversations",value:t}),h({field:"selectedConversation",value:t[t.length-1]}),h({field:"folders",value:r}),h({field:"prompts",value:a}),window.location.reload()},z=()=>{l&&h({field:"selectedConversation",value:{id:(0,tb.Z)(),name:e("New Conversation"),messages:[],model:b[l],prompt:"",temperature:j,folderId:null}}),h({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let t=s.filter(e=>"chat"!==e.type);h({field:"folders",value:t}),I(t)},Z=()=>{h({field:"showChatbar",value:!a}),localStorage.setItem("showChatbar",JSON.stringify(!a))},L=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));w(t,{key:"folderId",value:0}),C({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,o.jsx)(te.Provider,{value:{...t,handleDeleteConversation:k,handleClearConversations:z,handleImportConversations:T,handleExportData:_,handlePluginKeyChange:E,handleClearPluginKey:O,handleApiKeyChange:S,handleApiOrgChange:P},children:(0,o.jsx)(tf,{side:"left",isOpen:a,addItemButtonTitle:e("New chat"),itemComponent:(0,o.jsx)(tu,{conversations:r}),folderComponent:(0,o.jsx)(tr,{searchTerm:N}),paginatorComponent:(0,o.jsx)(tx,{}),items:r,searchTerm:N,handleSearchTerm:e=>{e&&null===c?(h({field:"pageBeforeSearch",value:d}),h({field:"selectedConversationPageIndexBeforeSearch",value:m}),h({field:"selectedConversationPageIndex",value:0}),h({field:"page",value:0})):""===e&&null!==c&&(h({field:"page",value:c}),h({field:"selectedConversationPageIndex",value:x}),h({field:"pageBeforeSearch",value:null}),h({field:"selectedConversationPageIndexBeforeSearch",value:null})),h({field:"searchTerm",value:e})},toggleOpen:Z,handleCreateItem:y,handleCreateFolder:()=>f(e("New folder"),"chat"),handleDrop:L,footerComponent:(0,o.jsx)(tc,{})})})},tj=()=>{let e=l.GPT_3_5,{t}=(0,u.$G)("chat"),{getModels:r,getConversations:a}=f(),{getModelsError:s}=h(),n=g(),[m,y]=(0,i.useState)(!0),E=p({initialState:G}),{state:{apiKey:_,apiOrg:T,lightMode:z,folders:Z,conversations:L,selectedConversation:D,selectedConversationPageIndex:R,prompts:A,page:K,searchTerm:M,messageCountFilterMode:F,messageCountFilterCount:J,totalPages:H},dispatch:$}=E,U=(0,i.useRef)(!1),{data:B,error:V,refetch:W}=(0,c.useQuery)(["GetModels",_,T,!1],e=>{let{signal:t}=e;return r({key:_,org:T},t)},{enabled:!0,refetchOnMount:!1});(0,i.useEffect)(()=>{B&&$({field:"models",value:B})},[B,$]);let{data:Y,error:q,refetch:Q}=(0,c.useQuery)(["GetConversations",K,M,F,J,15],e=>{let{signal:t}=e;return console.log("fetch conversations ".concat(K,", ").concat(M,", ").concat(F,", ").concat(J)),a({page:K,pageSize:15,searchTerm:M,messageCountFilterMode:F,messageCountFilterCount:J},t)},{enabled:!0,refetchOnMount:!1,refetchOnWindowFocus:!1});(0,i.useEffect)(()=>{var e,t=null==Y?void 0:null===(e=Y.conversations)||void 0===e?void 0:e.map(e=>e.data);if(t){if(0===(t=t.reverse()).length)$({field:"selectedConversation",value:void 0});else{let e=void 0===R?t.length-1:t.length-R-1;e<0&&(e=0),e>=t.length&&(e=t.length-1),t[e].id!==(null==D?void 0:D.id)&&$({field:"selectedConversation",value:t[e]})}$({field:"conversations",value:t}),$({field:"totalPages",value:null==Y?void 0:Y.totalPages}),$({field:"totalConversations",value:null==Y?void 0:Y.totalConversations})}},[Y,$]);let X=(e,t)=>{$({field:"selectedConversation",value:e}),$({field:"selectedConversationPageIndex",value:t}),C(e)},ee=(e,t)=>{let r={id:(0,tb.Z)(),name:e,type:t},a=[...Z,r];$({field:"folders",value:a}),I(a)},et=e=>{let t=Z.filter(t=>t.id!==e);$({field:"folders",value:t}),I(t);let r=L.map(t=>t.folderId===e?{...t,folderId:null}:t);$({field:"conversations",value:r}),S(r);let a=A.map(t=>t.folderId===e?{...t,folderId:null}:t);$({field:"prompts",value:a}),P(a)},er=(e,t)=>{let r=Z.map(r=>r.id===e?{...r,name:t}:r);$({field:"folders",value:r}),I(r)},ea=async()=>{var r;let a=L[L.length-1],l={id:(0,tb.Z)(),name:t("New Conversation"),messages:[],model:(null==a?void 0:a.model)||{id:b[e].id,name:b[e].name,maxLength:b[e].maxLength,tokenLimit:b[e].tokenLimit},prompt:"",temperature:null!==(r=null==a?void 0:a.temperature)&&void 0!==r?r:j,folderId:null};try{await n.post("/api/create_conversation",{body:l,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}$({field:"page",value:0}),$({field:"selectedConversationPageIndex",value:0}),Q(),$({field:"loading",value:!1})},el=async(e,t)=>{let r={...e,[t.key]:t.value};try{await n.post("/api/update_conversation",{body:r,headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error("".concat(e));return}let{single:a,all:l}=N(r,L);$({field:"selectedConversation",value:a}),$({field:"conversations",value:l})},es=async e=>{try{await n.post("/api/delete_conversation",{body:e,headers:{"Content-Type":"application/json"}})}catch(e){alert(e);return}Q()};(0,i.useEffect)(()=>{window.innerWidth<640&&$({field:"showChatbar",value:!1})},[D]),(0,i.useEffect)(()=>{e&&$({field:"defaultModelId",value:e})},[e,!1,!1]),(0,i.useEffect)(()=>{let r=O();r.theme&&$({field:"lightMode",value:r.theme});let a=localStorage.getItem("apiKey");a&&$({field:"apiKey",value:a});let l=localStorage.getItem("apiOrg");l?$({field:"apiOrg",value:l}):$({field:"apiOrg",value:""});let s=localStorage.getItem("pluginKeys");s&&$({field:"pluginKeys",value:s}),window.innerWidth<640&&($({field:"showChatbar",value:!1}),$({field:"showPromptbar",value:!1}));let n=localStorage.getItem("showChatbar");n&&$({field:"showChatbar",value:"true"===n});let o=localStorage.getItem("showPromptbar");o&&$({field:"showPromptbar",value:"true"===o});let i=localStorage.getItem("folders");i&&$({field:"folders",value:JSON.parse(i)});let d=localStorage.getItem("prompts");d&&$({field:"prompts",value:JSON.parse(d)});let c=localStorage.getItem("conversationHistory");if(c){let e=JSON.parse(c),t=k(e);$({field:"conversations",value:t})}let u=localStorage.getItem("selectedConversation");if(u){let e=JSON.parse(u),t=w(e);$({field:"selectedConversation",value:t})}else{var m;let r=L[L.length-1];$({field:"selectedConversation",value:{id:(0,tb.Z)(),name:t("New Conversation"),messages:[],model:b[e],prompt:"",temperature:null!==(m=null==r?void 0:r.temperature)&&void 0!==m?m:j,folderId:null}})}},[e,$,!1,!1]);let en=async(e,t)=>{try{await n.post("/api/split_conversation",{body:{conversation:e,messageIndex:t},headers:{"Content-Type":"application/json"}})}catch(e){d.ZP.error(JSON.stringify(e));return}if(D){var r;let e={...D,messages:null==D?void 0:null===(r=D.messages)||void 0===r?void 0:r.slice(0,t)},{single:a,all:l}=N(e,L);$({field:"selectedConversation",value:a}),$({field:"conversations",value:l})}void 0!==R&&(14===R?($({field:"page",value:K+1}),$({field:"selectedConversationPageIndex",value:0})):$({field:"selectedConversationPageIndex",value:R+1})),Q()};return(0,o.jsxs)(v.Provider,{value:{...E,handleNewConversation:ea,handleCreateFolder:ee,handleDeleteFolder:et,handleUpdateFolder:er,handleSelectConversation:X,handleUpdateConversation:el,handleDeleteConversation:es,handleSplitConversation:en},children:[(0,o.jsxs)(x(),{children:[(0,o.jsx)("title",{children:"LLM Labeling UI"}),(0,o.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,o.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsx)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(z),children:(0,o.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,o.jsx)(ty,{}),(0,o.jsx)("div",{className:"flex flex-1",children:(0,o.jsx)(e1,{stopConversationRef:U})}),(0,o.jsx)(ep,{})]})})]})};var tw=tj}},function(e){e.O(0,[879,791,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);